{%extends "base/base.html"%}
{%block title%} Purchase order{%endblock%}
    
{%block content%}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h1 class="card-title text-center"><b>Supplier details</b></h1><br>
                    <form method="POST" class="needs-validation" novalidate>
                        {% csrf_token %}

                      
                    </form>
                    <a href="{% url 'inventory:supplier_list' %}" class="btn btn-link"><i class="fa fa-eye" style="color: darkblue"></i> Back to List</a>
                </div>
            </div>
        </div>
    </div>    
</div>
<form method="POST" action="{% url 'purchase_order:save_form_data' %}" id="form">
  {% csrf_token %}
  <input type="text" name="product[]" id="product"value ="">
  <input type="text" name="quantity[]" id="quantity"value ="">
  <input type="text" name="unit_price[]" id="unit_price"value ="">
  <input type="button" class="btn btn-secondary" onclick="addproduct()" value="Add Item">
  <button type="button" class="btn btn-primary" id="saveChangesButton" onclick="openModal()">Save changes</button>

  <table id="table" class="table">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Product</th>
        <th scope="col">Quantity</th>
        <th scope="col">Unit Price</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>

    </tbody>
    <tfoot>
      <tr id="totalsRow">
        <td colspan="3">Totals:</td>
        <td id="totalsCell"></td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary" id="saveChanges" data-toggle="modal" data-target="#exampleModal">
    Checkout
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id='Supplier details'>
            Name of the supplier:<br>
            Email:
            Name of the buyer
          </div>
          <div>
            <table id="table1" class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Product</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Unit Price</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
function addproduct() {
  var product = document.getElementById('product').value;
  var quantity = parseInt(document.getElementById('quantity').value);
  var unit_price = parseFloat(document.getElementById('unit_price').value);

  if (isNaN(quantity)) {
    alert('Please enter a valid quantity.');
    return;
  }

  if (isNaN(unit_price)) {
    alert('Please enter a valid unit price.');
    return;
  }

  var table = document.getElementById('table');
  var table1 = document.getElementById('table1');
  var rowCount = table.rows.length;

  var tr = table.insertRow(rowCount - 1); // Insert before the totals row
  var tr1 = table1.insertRow(rowCount - 1); // Insert

  var indexCell = tr.insertCell(0);
  var productCell = tr.insertCell(1);
  var quantityCell = tr.insertCell(2);
  var priceCell = tr.insertCell(3);
  var actionsCell = tr.insertCell(4);
  
  var indexCell1 = tr1.insertCell(0);
  var productCell1 = tr1.insertCell(1);
  var quantityCell1 = tr1.insertCell(2);
  var priceCell1 = tr1.insertCell(3);


  indexCell.innerHTML = rowCount - 1;
  productCell.innerHTML = product;
  quantityCell.innerHTML = quantity;
  priceCell.innerHTML = unit_price.toFixed(2);
  
  indexCell1.innerHTML = rowCount - 1;
  productCell1.innerHTML = product;
  quantityCell1.innerHTML = quantity;
  priceCell1.innerHTML = unit_price.toFixed(2);

  var deleteButton = document.createElement('button');
  deleteButton.innerHTML = 'Delete';
  deleteButton.addEventListener('click', function() {
    var currentRow = this.parentNode.parentNode;
    currentRow.parentNode.removeChild(currentRow);
    updateTotals();
  });

  actionsCell.appendChild(deleteButton);

  // Reset input fields
  document.getElementById('product').value = '';
  document.getElementById('quantity').value = '';
  document.getElementById('unit_price').value = '';

  updateTotals();
}

function updateTotals() {
  var table = document.getElementById('table');
  var totalsCell = document.getElementById('totalsCell');
  var total = 0;

  for (var i = 1; i < table.rows.length - 1; i++) {
    var price = parseFloat(table.rows[i].cells[3].innerHTML);
    total += price;
  }

  totalsCell.innerHTML = total.toFixed(2);
}
  

</script>



{%endblock%}